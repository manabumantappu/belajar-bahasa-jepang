<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Live Chat</title>
<link rel="stylesheet" href="chat.css">

<!-- ğŸ” PROTEKSI ADMIN (PALING ATAS) -->
<script>
const pass = prompt("Password admin:");
if(pass !== "admin123"){
  alert("Akses ditolak");
  location.href = "/";
}
</script>

<style>
body{
  font-family:system-ui, sans-serif;
  background:#f1f5f9;
  padding:20px;
}
h2{
  text-align:center;
  margin-bottom:20px;
}
#chat-box{
  display:flex;
  position:relative;
  max-width:500px;
  margin:0 auto;
  height:520px;
}
.chat-input{
  display:flex;
}
.chat-input input{
  flex:1;
}
</style>
</head>

<body>

<h2>ğŸ§‘â€ğŸ’¼ Admin Live Chat</h2>

<div id="chat-box">
  <div id="messages"></div>

  <div class="chat-input">
    <input type="text" id="msg" placeholder="Balas pesan user..." />
    <button onclick="sendMessage()">Kirim</button>
  </div>
</div>

<!-- ğŸ”¥ FIREBASE ADMIN CHAT -->
<script type="module">
import { initializeApp } from 
"https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";

import { getDatabase, ref, push, onChildAdded, query, limitToLast } 
"https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBLBKQumtxegU4-oAX294e-WI3V57Dg",
  authDomain: "manabu-mantappu-chat.firebaseapp.com",
  databaseURL: "https://manabu-mantappu-chat-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "manabu-mantappu-chat",
  storageBucket: "manabu-mantappu-chat.appspot.com",
  messagingSenderId: "123456789012",
  appId: "1:123456789012:web:abcdef123456"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const messagesEl = document.getElementById("messages");
messagesEl.innerHTML = "";

/* ğŸ§‘â€ğŸ’¼ ADMIN KIRIM PESAN */
window.sendMessage = () => {
  const msg = document.getElementById("msg").value;
  if(!msg) return;

  push(ref(db,"chat"),{
    text: msg,
    time: Date.now(),
    role: "admin"
  });

  document.getElementById("msg").value="";
};

/* ğŸ“© TERIMA PESAN */
const chatQuery = query(ref(db, "chat"), limitToLast(1));

onChildAdded(chatQuery, (snap) => {
  const data = snap.val();
  const div = document.createElement("div");

  div.className = data.role === "admin"
    ? "msg-admin"
    : "msg-user";

  div.innerText = data.text;
  messagesEl.appendChild(div);
  messagesEl.scrollTop = messagesEl.scrollHeight;
});
</script>

</body>
</html>
